<?php

/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

defined('InShopNC') or exit('Access Invalid!');
class decoration_pubControl extends mobileHomeControl{
    public function __construct() {
		parent::__construct();
	}
        
    
        public function getDcListOp($param) {
            error_reporting(0);
            $post=$this->read_json();
            $model_store = Model('store');
            
            //var_dump($_REQUEST['param'][0]);
            
            //$model_store=  Model('seller');
            $storeList=$model_store->getDcStoreOnlineIdArray($post->conditions,$post->pageCount,$post->sortType);
            
            $storeListBasic = $model_store-> getDcInfoBasic($storeList);
            
            $count=$model_store->getDcStoreCount($post->conditions);
            
            $storeListBasic= array_values($storeListBasic);
            
            if($count>0){
                output_data(array('storeBasic_list' => $storeListBasic), mobile_page($count));
               // output_data($storeList,array('statuCode'=>array('10200'),'total'=>$count));
            }else{
                output_error('10404');
            }
            
        }
        
        public function dbindexOp() {
            //$post=$this->read_json();
          //  $model_db=Model('decoration');
           // $_REQUEST = objectToArray($post);
           // output_data($_REQUEST);
            if($_REQUEST['user_id']<1){
                 output_error('10404');
             }
            $model_db = Model('decoration');
            $condition['dw_user_id']=intval($_REQUEST['user_id']);
            $result=$model_db->getWorkCommonList($condition,'',$_REQUEST['pageCount']);
            
            $result=$model_db->getExtWorkListDc($result);
            if($result){
                 output_data(array('dt_list'=>$result));
            }
        }
        
        public function dbOp() {
            //$post=$this->read_json();
          //  $model_db=Model('decoration');
           // $_REQUEST = objectToArray($post);
           // output_data($_REQUEST);
          // var_dump('122111111111');
            $model_db = Model('decoration');
            $condition['dw_id']=intval($_REQUEST['db_id']);
            $result=$model_db->getRequestInfo($condition);
            $result=$model_db->getExtWorkUser($result);
            if($result){
                 output_data(array('db'=>$result));
            }
        }
        
        
         public function cancelRequestOp() {
            $model_db = Model('decoration');
            //$condition['dw_user_id']=$_REQUEST['user_id'];
            $update['dw_result']=!empty($_REQUEST['result'])?$_REQUEST['result']:'个人原因';
            $update['dw_state']=0;
          //  $dw_user_id=$_REQUEST['dw_id'];
            $condition['dw_id']=$_REQUEST['dw_id'];
            $result=$model_db->cancelBt($update,$condition);
            if($result){
                 output_suc('10200');
            }else{
                output_error('10500');
            }
        }
        
         public function selctBidOp() {
            $model_db = Model('bid_target');
            //$condition['dw_user_id']=$_REQUEST['user_id'];
            
            $data['bt_user_id']=  intval($_REQUEST['user_id']);
            $data['bt_dc_id']=intval($_REQUEST['dc_id']);
            $data['bt_rid']=intval($_REQUEST['dw_id']);
            $data['bt_evaluation']=$_REQUEST['evaluation'];
            $result=$model_db->selectBid($data);
            $condition2['bid_id']=  intval($_REQUEST['bid_id']);
            $dw_id=  intval($_REQUEST['dw_id']);
            if($result){
                $result=Model('bid')->selectedUpdateBid($condition2,$dw_id);
            }
            $data2['store_dc_deals']='store_dc_deals+1';
            $scondition['store_id']=intval($_REQUEST['dc_id']);
            Model('store')->editStore($data2,$scondition);
            if($result){
                 output_suc('10200');
            }else{
                output_error('10500');
            }
        }
        
        
        

        
        
}